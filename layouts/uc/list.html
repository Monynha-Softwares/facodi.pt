{{ define "body_attributes" -}}
{{- with .Params.code }} data-uc="{{ . | htmlEscape }}"{{ end -}}
{{- with .Parent }}
  {{- with .Parent }}
    {{- with .Params.code }} data-course="{{ . | htmlEscape }}"{{ end -}}
    {{- with .Params.plan_version }} data-plan="{{ . | htmlEscape }}"{{ end -}}
  {{- end -}}
{{- end -}}
{{- end }}

{{ define "main" }}
{{ $params := .Params }}
{{ $scratch := newScratch }}
{{ with .Parent }}
  {{ with .Parent }}
    {{ $scratch.Set "courseCode" (.Params.code | default "") }}
    {{ $scratch.Set "planVersion" (.Params.plan_version | default "") }}
  {{ end }}
{{ end }}
{{ $courseCode := $scratch.Get "courseCode" | default "" }}
{{ $planVersion := $scratch.Get "planVersion" | default "" }}
<section class="section container py-5">
  <div class="row justify-content-center mb-5">
    <div class="col-lg-10">
      <div class="d-flex flex-column flex-lg-row justify-content-between gap-4">
        <div>
          <span class="badge bg-secondary-subtle text-secondary">{{ $params.code }}</span>
          {{ with $params.semester }}
          <span class="badge bg-info-subtle text-info ms-2"><span data-i18n-key="common.semester">{{ i18n "common.semester" }}</span> {{ . }}</span>
          {{ end }}
          <h1 class="display-6 mt-3">{{ .Title }}</h1>
          {{ with $params.description }}<p class="lead text-muted">{{ . }}</p>{{ end }}
        </div>
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <dl class="row mb-0 small">
              <dt class="col-6 col-lg-5" data-i18n-key="common.ects">{{ i18n "common.ects" }}</dt>
              <dd class="col-6 col-lg-7 text-lg-end">{{ $params.ects | default "--" }}</dd>
              <dt class="col-6 col-lg-5" data-i18n-key="common.language">{{ i18n "common.language" }}</dt>
              <dd class="col-6 col-lg-7 text-lg-end">{{ $params.language | default "--" }}</dd>
              <dt class="col-6 col-lg-5" data-i18n-key="uc.prerequisites">{{ i18n "uc.prerequisites" }}</dt>
              <dd class="col-6 col-lg-7 text-lg-end" data-facodi-uc-prerequisites>
                {{ if $params.prerequisites }}
                  {{ delimit $params.prerequisites ", " }}
                {{ else }}
                  <span class="text-muted" data-i18n-key="uc.noPrerequisites">{{ i18n "uc.noPrerequisites" }}</span>
                {{ end }}
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row justify-content-center">
    <div class="col-lg-7 order-lg-1">
      <article class="content mb-5" id="uc-content" data-facodi-slot="uc-content">{{ .Content }}</article>
      {{ $topics := .RegularPages }}
      <section class="mb-5" id="uc-topics" data-facodi-slot="uc-topics">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h2 class="h4 mb-0" data-i18n-key="uc.topics">{{ i18n "uc.topics" }}</h2>
          {{ $topicCount := len $topics }}
          <span class="text-muted small">{{ $topicCount }} <span data-i18n-key="{{ if eq $topicCount 1 }}common.topic{{ else }}common.topics{{ end }}">{{ if eq $topicCount 1 }}{{ i18n "common.topic" }}{{ else }}{{ i18n "common.topics" }}{{ end }}</span></span>
        </div>
        {{ if not (len $topics) }}
        <div class="alert alert-info" role="alert" data-i18n-key="uc.noTopics">{{ i18n "uc.noTopics" }}</div>
        {{ else }}
        <div class="list-group list-group-flush">
          {{ range sort $topics "Title" }}
          <a class="list-group-item list-group-item-action" href="{{ partial "facodi/langless-url.html" (dict "url" .RelPermalink) }}">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h3 class="h6 mb-1">{{ .Title }}</h3>
                {{ with .Params.summary }}<p class="mb-1 small text-muted">{{ . }}</p>{{ end }}
              </div>
              {{ with .Params.youtube_playlists }}
              {{ $playlistCount := len . }}
              <span class="badge bg-primary-subtle text-primary">{{ $playlistCount }} <span data-i18n-key="{{ if eq $playlistCount 1 }}common.playlist{{ else }}common.playlists{{ end }}">{{ if eq $playlistCount 1 }}{{ i18n "common.playlist" }}{{ else }}{{ i18n "common.playlists" }}{{ end }}</span></span>
              {{ end }}
            </div>
            {{ with .Params.tags }}
            <div class="mt-2">
              {{ range . }}<span class="badge rounded-pill bg-light text-muted me-1">{{ . }}</span>{{ end }}
            </div>
            {{ end }}
          </a>
          {{ end }}
        </div>
        {{ end }}
      </section>
    </div>
    <div class="col-lg-3 order-lg-0">
      <aside class="mb-5" id="uc-learning-outcomes" data-facodi-slot="uc-outcomes">
        <h2 class="h5" data-i18n-key="uc.learningOutcomes">{{ i18n "uc.learningOutcomes" }}</h2>
        {{ if $params.learning_outcomes }}
        <ol class="ps-3">
          {{ range $params.learning_outcomes }}<li class="mb-2">{{ . }}</li>{{ end }}
        </ol>
        {{ else }}
        <p class="text-muted small" data-i18n-key="uc.noLearningOutcomes">{{ i18n "uc.noLearningOutcomes" }}</p>
        {{ end }}
      </aside>
      <aside id="uc-playlists" data-facodi-slot="uc-playlists">
        <h2 class="h5" data-i18n-key="uc.playlists">{{ i18n "uc.playlists" }}</h2>
        {{ if $params.youtube_playlists }}
        <ul class="list-unstyled">
          {{ range sort $params.youtube_playlists "priority" }}
          <li class="mb-2">
            <a class="d-inline-flex align-items-center" href="https://www.youtube.com/playlist?list={{ .id }}" target="_blank" rel="noopener">
              <span class="badge bg-danger me-2">YT</span>{{ .id }}
            </a>
          </li>
          {{ end }}
        </ul>
        {{ else }}
        <p class="text-muted small" data-i18n-key="uc.noPlaylists">{{ i18n "uc.noPlaylists" }}</p>
        {{ end }}
      </aside>
    </div>
  </div>
</section>
<script>
window.facodiPageContext = Object.assign(window.facodiPageContext || {}, {
  ucCode: {{ $params.code | default "" | jsonify }},
  courseCode: {{ $courseCode | jsonify }},
  planVersion: {{ $planVersion | jsonify }}
});
</script>
{{ end }}
