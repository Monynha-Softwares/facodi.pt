{{ define "main" }}
<section class="section container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <header class="mb-4">
        <p class="text-uppercase text-muted small mb-2">{{ .Params.code }} · {{ with .Params.semester }}Semestre {{ . }}{{ end }}</p>
        <h1 class="display-6 fw-semibold">{{ .Title }}</h1>
        {{ with .Params.description }}<p class="lead">{{ . }}</p>{{ end }}
      </header>
      <div class="row g-4 align-items-start">
        <div class="col-md-7">
          <div class="content" id="facodi-uc-content">{{ .Content }}</div>
        </div>
        <div class="col-md-5">
          <div class="card shadow-sm mb-4">
            <div class="card-body">
              <h2 class="h6 text-uppercase text-muted">Informações da UC</h2>
              <dl class="row small mb-0">
                <dt class="col-6">ECTS</dt>
                <dd class="col-6">{{ .Params.ects }}</dd>
                <dt class="col-6">Idioma</dt>
                <dd class="col-6 text-uppercase">{{ .Params.language }}</dd>
                {{ with .Params.semester }}
                <dt class="col-6">Semestre</dt>
                <dd class="col-6">{{ . }}</dd>
                {{ end }}
              </dl>
            </div>
          </div>
          {{ with .Params.prerequisites }}
          <div class="card shadow-sm mb-4">
            <div class="card-body">
              <h2 class="h6 text-uppercase text-muted">Pré-requisitos</h2>
              <ul class="list-unstyled small mb-0">
                {{ range . }}<li class="mb-1">{{ . }}</li>{{ end }}
              </ul>
            </div>
          </div>
          {{ end }}
          {{ with .Params.learning_outcomes }}
          <div class="card shadow-sm">
            <div class="card-body">
              <h2 class="h6 text-uppercase text-muted">Resultados de aprendizagem</h2>
              <ul class="list-unstyled small mb-0">
                {{ range . }}
                <li class="d-flex align-items-start mb-2">
                  <span class="badge bg-success-subtle text-success me-2">✓</span>
                  <span>{{ . }}</span>
                </li>
                {{ end }}
              </ul>
            </div>
          </div>
          {{ end }}
        </div>
      </div>
    </div>
  </div>
</section>

{{ with .Params.youtube_playlists }}
<section class="section container pb-5">
  <div class="row mb-4">
    <div class="col-lg-10">
      <h2 class="h4">Playlists recomendadas</h2>
      <p class="text-muted">Seleção da comunidade FACODI para acompanhar a unidade curricular.</p>
    </div>
  </div>
  <div class="row g-4" id="facodi-uc-playlists">
    {{ range . }}
    <div class="col-md-6">
      <article class="card h-100 shadow-sm">
        <div class="card-body">
          <h3 class="h5">{{ .title | default "Playlist" }}</h3>
          <p class="text-muted small">Prioridade {{ .priority | default 1 }}</p>
          <a class="btn btn-outline-primary" target="_blank" rel="noopener" href="https://www.youtube.com/playlist?list={{ .id }}">Abrir no YouTube</a>
        </div>
      </article>
    </div>
    {{ end }}
  </div>
</section>
{{ end }}

{{ $topicPages := .Resources.Match "*.md" }}
{{ if $topicPages }}
<section class="section container pb-5">
  <div class="row mb-4">
    <div class="col-lg-10">
      <h2 class="h4">Tópicos sugeridos</h2>
      <p class="text-muted">Cada tópico reúne playlists e materiais complementares.</p>
    </div>
  </div>
  <div class="row g-4" id="facodi-uc-topics">
    {{ range $topicPages }}
    <div class="col-md-6">
      <article class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column">
          <h3 class="h5">{{ .Title }}</h3>
          {{ with .Params.summary }}<p class="flex-grow-1">{{ . }}</p>{{ end }}
          <a class="btn btn-outline-secondary mt-auto" href="{{ .RelPermalink }}">Ver tópico</a>
        </div>
      </article>
    </div>
    {{ end }}
  </div>
</section>
{{ end }}

{{ $pageMeta := dict "type" "uc" "code" .Params.code }}
<script id="facodi-page-meta" type="application/json">{{ $pageMeta | jsonify }}</script>
{{ $topicData := slice }}
{{ range $topicPages }}
  {{ $topicData = $topicData | append (dict "slug" .Params.slug "title" .Title "summary" .Params.summary "playlists" .Params.youtube_playlists "tags" .Params.tags "content_markdown" (.RawContent | default "") "content_html" .Content "url" .RelPermalink) }}
{{ end }}
{{ $ucData := dict "code" .Params.code "title" .Title "description" .Params.description "ects" .Params.ects "semester" .Params.semester "language" .Params.language "prerequisites" .Params.prerequisites "learning_outcomes" .Params.learning_outcomes "youtube_playlists" .Params.youtube_playlists "content_markdown" (.RawContent | default "") "content_html" .Content "topics" $topicData }}
<script id="facodi-uc-data" type="application/json">{{ $ucData | jsonify }}</script>
{{ end }}
