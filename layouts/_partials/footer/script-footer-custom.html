{{- $supabaseUrl := or (getenv "SUPABASE_URL") site.Params.facodi.supabaseUrl -}}
{{- $supabaseAnon := or (getenv "SUPABASE_ANON_KEY") site.Params.facodi.supabaseAnonKey -}}
<script id="facodi-config" type="application/json">{{ dict "supabaseUrl" $supabaseUrl "supabaseAnonKey" $supabaseAnon | jsonify | safeHTML }}</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js" integrity="sha384-AkNSQdptcXlJ0/NBZc4qGk86cDVXcCevwoWgEKIpHOEfbvlXGLlIkimQtONt8KNf" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@12/marked.min.js" integrity="sha384-/TQbtLCAerC3jgaim+N78RZSDYV7ryeoBCVqTuzRrFec2akfBkHS7ACQ3PQhvMVi" crossorigin="anonymous"></script>
<script src="{{ "js/supabaseClient.js" | relURL }}" defer></script>
<script src="{{ "js/loaders.js" | relURL }}" defer></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    if (!window.facodiLoaders || !document.body) {
      return;
    }

    const dataset = document.body.dataset || {};
    const context = window.facodiPageContext || {};

    const courseCode = dataset.course || context.courseCode;
    const planVersion = dataset.planVersion || context.planVersion;
    const ucCode = dataset.uc || context.ucCode;
    const topicSlug = dataset.topic || context.topicSlug;

    if (courseCode) {
      window.facodiLoaders.loadCoursePage(courseCode, planVersion);
    }
    if (ucCode) {
      window.facodiLoaders.loadUCPage(ucCode);
    }
    if (topicSlug) {
      window.facodiLoaders.loadTopicPage(topicSlug);
    }
  });
</script>
